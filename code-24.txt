#include <stdio.h>
#include <fcntl.h>      // For open()
#include <unistd.h>     // For read(), write(), close(), unlink()
#include <stdlib.h>
#include <string.h>

int main() {
    char filename[50], data[100], buffer[100];
    int fd, n;

    printf("Enter file name to create: ");
    scanf("%s", filename);

    // Create a new file (read/write, create if doesn't exist, truncate if exists)
    fd = open(filename, O_CREAT | O_RDWR | O_TRUNC, 0644);
    if (fd == -1) {
        perror("Error creating file");
        exit(1);
    }
    printf("File '%s' created successfully.\n", filename);

    // Write data to file
    printf("Enter data to write to file: ");
    getchar(); // Consume leftover newline
    fgets(data, sizeof(data), stdin);

    n = write(fd, data, strlen(data));
    if (n == -1) {
        perror("Error writing to file");
        close(fd);
        exit(1);
    }
    printf("Data written successfully.\n");

    // Move file pointer to beginning
    lseek(fd, 0, SEEK_SET);

    // Read data from file
    printf("\nReading data from file:\n");
    n = read(fd, buffer, sizeof(buffer));
    if (n == -1) {
        perror("Error reading file");
        close(fd);
        exit(1);
    }
    buffer[n] = '\0'; // Null-terminate string
    printf("%s\n", buffer);

    // Close file
    close(fd);
    printf("File closed successfully.\n");

    // Delete file
    if (unlink(filename) == 0)
        printf("File '%s' deleted successfully.\n", filename);
    else
        perror("Error deleting file");

    return 0;
}
